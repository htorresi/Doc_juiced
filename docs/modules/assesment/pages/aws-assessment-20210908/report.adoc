= AWS Security Assessment Report for *{company-name}*
:doctype: book
//:stylesheet: asciidoc.css
:table-stripes: even

== Executive summary

This report presents the results of the {audit-type} audit for {company-name} AWS Account {aws-account}, performed during the audit period {audit-period-sep} .

The recommendations provided in this report provide guidanance on the recommendations​ of the identified security risks. This document serves as an assesement of the security controls in place, for the given risk and compliance requirement for the company, and is based on the results of AWS Security Assessment Testing performed over the audit period. Evaluation ratings compare information gathered during the course of the engagement to “best in class” criteria for security standards. These security standards are based on:

- CIS AWS Foundation Benchmark 1.2, Level 2
- AWS consensus best-practices.  

We highly recommend to review section of Summary of Business Risks and High-Level and Recommendations for better understanding of risks and discovered security issues.

|===
|Scope |Security Level |Grade 

|AWS CIS Benchmark Foundation 1.2
|Excellent
|[green]#A#

|===

Grading Criteria

[cols="1,2,6"]
|===
|Grade |Security |Description 

|[green]#A#
|Excellent
|The security exceeds “Industry Best Practice” standards. The overall posture was found to be excellent with only a few low-risk findings identified.

|[maroon]#B#
|Good
|The security meets with accepted standards for “Industry Best
Practice.” The overall posture was found to be strong with only a
handful of medium- and low- risk shortcomings identified.

|[red]#C#
|Fair
|Current solutions protect some areas of the enterprise from security issues. Moderate changes are required to elevate the discussed areas to “Industry Best Practice” standards

|[red]#D#
|Poor
|Significant security deficiencies exist. Immediate attention should be given to the discussed issues to address exposures identified. Major changes are required to elevate to “Industry Best Practice” standards.

|[red]#F#
|Inadequate
|Serious security deficiencies exist. Shortcomings were identified throughout most or even all of the security controls examined. Improving security will require a major allocation of resources.
|===


== Assumptions & Constraints

As the environment changes, and new vulnerabilities and risks are discovered and made
public, an organization’s overall security posture will change. Such changes may affect the validity of this report. Therefore, the conclusion reached from our analysis only represents a “snapshot” in time.


== Objectives & Scope

// ****
// sidebar block
// ****

Overview

This document provides prescriptive guidance for configuring security options for a subset of Amazon Web Services with an emphasis on foundational, testable, and architecture agnostic settings. Specific Amazon Web Services in scope for this document include:

 - AWS Identity and Access Management (IAM)
 - AWS Config
 - AWS CloudTrail
 - AWS CloudWatch
 - AWS Simple Notification Service (SNS)
 - AWS Simple Storage Service (S3)
 - AWS VPC (Default)

Organization:: {company-name}
Audit Type:: AWS Security Assesment
Accounts:: {aws-account} 
Audit period:: {audit-period-sep}

Consultants performed discovery process to gather information about the target and searched for information disclosure vulnerabilities. With this data in hand, we conducted the bulk of the testing manually, which consisted of input validation tests, impersonation (authentication and authorization) tests, and session state management tests. The purpose of this penetration
testing is to illuminate security risks by leveraging weaknesses  within the environment that leadto the obtainment of unauthorized access and/or the retrieval of sensitive information. The shortcomings identified during the assessment were used to formulate recommendations and mitigation strategies for improving the overall security posture.

== Results Overview     

The test uncovered a vulnerabilities that may cause sensitive data leakage, broken confidentiality and integrity and availability of the resource.
Identified vulnerabilities are exploitable and the risk posed by these vulnerabilities can cause damage to the application and company.

**CIS Benchmark 1.2 Level 2**

image::aws-assesment-20210910/Vulnerabilities_20210910.png[]

We performed manual and automated security testing according to the testing methodology.

// //
// Severity scoring:
// *Severity* ({caret}) *Critical High Medium Low Informationa* ​ **l
// - *Critical* ​ - ​Immediate threat to key business processes.
// - *High* ​ -- Direct threat to key business processes.
// - *Medium* -- Indirect threat to key business processes or partial threat to business
// processes.
// - *Low* ​ -- No direct threat exists. Vulnerability may be exploited using other vulnerabilities.
// - *Informational* -- This finding does not indicate vulnerability, but states a comment that
// notifies about design flaws and improper implementation that might cause a problem in
// the long run.

|===
|Severity |[maroon]#Critical# |[red]#High# |[blue]#Medium# |[green]#Low# |Informational 

|# Of issues
|6
|55
|158
|3
|7 

|===

Severity scoring:

* *Severity*
- *[maroon]#Critical#* -- Immediate threat to key business processes.
- *[red]#High#* -- Direct threat to key business processes.
- *[blue]#Medium#* -- Indirect threat to key business processes or partial threat to business processes.
- *[green]#Low#* ​ -- No direct threat exists. Vulnerability may be exploited using other vulnerabilities.
- *Informational* -- This finding does not indicate vulnerability, but states a comment that notifies about design flaws and improper implementation that might cause a problem in the long run.

=== Summary of Business Risks

Medium and low severity issues can lead to:

- Attacks on communication channels and as a result on sensitive data leakage and
possible modification, in other words it affects the integrity and confidentiality of data transferred.
- Information leakage about system components which may be used by attackers for
further malicious actions.
- Attacks on old and not patched system components with bunch of publicly known
vulnerabilities.
- Enumerating existing users emails/usernames and brute forcing their passwords. Easy access to their session after exploitation of high level risks.
- Combination of few issues can be used for successful realisation of attacks.

Informational severity issues do not carry direct threat but they can be used to gather useful information for an attacker.


=== High-Level Recommendations

Taking into consideration all issues that have been discovered, we highly recommend to:

- Conduct current vs. future IT/Security program review
- Conduct Static code analysis for codebase
- Establish Secure SDLC best practices, assign Security Engineer to a project to monthly review code, conduct SAST & DAST security testing
- Review Architecture of application
- Deploy Web Application Firewall solution to detect any malicious manipulations
- Continuously monitor logs for anomalies to detect abnormal behaviour and fraud
transactions. Dedicate security operations engineer to this task
- Implement Patch Management procedures for whole IT infrastructure and endpoints of employees and developers
- Continuously Patch production and development environments and systems on regular bases with latest releases and security updates
- Conduct annual Penetration test and quarterly Vulnerability Scanning against internal and external environment
- Develop and Conduct Security Awareness training for employees and developers
- Develop Incident Response Plan in case of Data breach or security incidents
- Analyse risks for key assets and resources
- Update codebase to conduct verification and sanitization of user input on both, client and server side
- Use only encrypted channels for communications
- Do not send any unnecessary data in requests and cookies
- Improve server and application configuration to meet security best practises


== Performed tests

* The applicable CIS AWS Benchmark tests

=== CIS AWS Foundation Benchmark 1.2 Level 2

|===
|Criteria Label |Status 

|xref:ROOT:cis-benchmark.adoc[1.1  Avoid the use of the root account]|Meets criteria
|xref:ROOT:cis-benchmark.adoc[1.2  Ensure multi-factor authentication (MFA) is enabled for all IAM users that have a console password]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.3  Ensure credentials unused for 90 days or greater are disabled]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.4  Ensure access keys are rotated every 90 days or less]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.5  Ensure IAM password policy requires at least one uppercase letter]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.6  Ensure IAM password policy require at least one lowercase letter]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.7  Ensure IAM password policy require at least one symbol]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.8  Ensure IAM password policy require at least one number]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.9  Ensure IAM password policy requires minimum length of 14 or greater]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.10  Ensure IAM password policy prevents password reuse: 24 or greater]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.11  Ensure IAM password policy expires passwords within 90 days or less]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.12  Ensure no root account access key exists]|Meets criteria
|xref:ROOT:cis-benchmark.adoc[1.13  Ensure MFA is enabled for the root account]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.15 Ensure security questions are registered in the AWS account  ]|User root can test
|xref:ROOT:cis-benchmark.adoc[1.16  Ensure IAM policies are attached only to groups or roles]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.17 Maintain current contact details  ]|User root can test
|xref:ROOT:cis-benchmark.adoc[1.18 Ensure security contact information is registered  ]|User root can test
|xref:ROOT:cis-benchmark.adoc[1.19 Ensure IAM instance roles are used for AWS resource access from instances]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.20  Ensure a support role has been created to manage incidents with AWS Support]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.22  Ensure IAM policies that allow full "*:*" administrative privileges are not created]|Meets criteria
|xref:ROOT:cis-benchmark.adoc[2.1  Ensure CloudTrail is enabled in all regions]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.3  Ensure the S3 bucket CloudTrail logs to is not publicly accessible]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.4  Ensure CloudTrail trails are integrated with CloudWatch Logs]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.5  Ensure AWS Config is enabled in all regions]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.6  Ensure S3 bucket access logging is enabled on the CloudTrail S3 bucket]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.1  Ensure a log metric filter and alarm exist for unauthorized API calls]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.2  Ensure a log metric filter and alarm exist for Management Console sign-in without MFA]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.3  Ensure a log metric filter and alarm exist for usage of root account]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.4  Ensure a log metric filter and alarm exist for IAM policy changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.5  Ensure a log metric filter and alarm exist for CloudTrail configuration changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.8  Ensure a log metric filter and alarm exist for S3 bucket policy changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.12  Ensure a log metric filter and alarm exist for changes to network gateways]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.13  Ensure a log metric filter and alarm exist for route table changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.14  Ensure a log metric filter and alarm exist for VPC changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[4.1  Ensure no security groups allow ingress from 0.0.0.0/0 or ::/0 to port 22]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[4.2  Ensure no security groups allow ingress from 0.0.0.0/0 or ::/0 to port 3389]|Fails criteria

|Criteria Label |Status 

|xref:ROOT:cis-benchmark.adoc[1.2  Ensure multi-factor authentication (MFA) is enabled for all IAM users that have a console password]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.3  Ensure credentials unused for 90 days or greater are disabled]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.5  Ensure IAM password policy requires at least one uppercase letter]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.6  Ensure IAM password policy require at least one lowercase letter]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.7  Ensure IAM password policy require at least one symbol]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.8  Ensure IAM password policy require at least one number]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.9  Ensure IAM password policy requires minimum length of 14 or greater]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[1.12  Ensure no root account access key exists]|Meets criteria
|xref:ROOT:cis-benchmark.adoc[1.13  Ensure MFA is enabled for the root account]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.1  Ensure CloudTrail is enabled in all regions]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.3  Ensure the S3 bucket CloudTrail logs to is not publicly accessible]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.4  Ensure CloudTrail trails are integrated with CloudWatch Logs]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.6  Ensure S3 bucket access logging is enabled on the CloudTrail S3 bucket]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.8  Ensure rotation for customer created CMKs is enabled ]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[2.9   Ensure VPC Flow Logging is Enabled in all VPCs]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.1  Ensure a log metric filter and alarm exist for unauthorized API calls]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.2  Ensure a log metric filter and alarm exist for Management Console sign-in without MFA]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.3  Ensure a log metric filter and alarm exist for usage of root account]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.4  Ensure a log metric filter and alarm exist for IAM policy changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.5  Ensure a log metric filter and alarm exist for CloudTrail configuration changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.6  Ensure a log metric filter and alarm exist for AWS Management Console authentication failures]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.7  Ensure a log metric filter and alarm exist for disabling or scheduled deletion of customer created CMKs]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.8  Ensure a log metric filter and alarm exist for S3 bucket policy changes]|Fails criteria
|xref:ROOT:cis-benchmark.adoc[3.9  Ensure a log metric filter and alarm exist for AWS Config configuration changes]|Fails criteria
|7.2 Ensure there are no EBS Snapshots set as Public (Not part of CIS benchmark)|Meets criteria
|7.3 Ensure there are no S3 buckets open to the Everyone or Any AWS user (Not part of CIS benchmark)|Fails criteria
|7.5 Ensure there are no Security Groups not being used (Not part of CIS benchmark)|Meets criteria
|7.17 Check if Elastic Load Balancers have logging enabled (Not part of CIS benchmark)|Fails criteria
|7.18 Check if S3 buckets have server access logging enabled (Not part of CIS benchmark)|Fails criteria
|7.25 Check if S3 buckets have Object-level logging enabled in CloudTrail (Not part of CIS benchmark)|Fails criteria
|7.29 Ensure there are no EBS Volumes unencrypted (Not part of CIS benchmark)|Meets criteria
|7.34 Check if S3 buckets have default encryption (SSE) enabled or use a bucket policy to enforce it (Not part of CIS benchmark)|Fails criteria
|7.35 Check if RDS instances storage is encrypted (Not part of CIS benchmark)|Meets criteria
|7.40 Check if EBS snapshots are encrypted (Not part of CIS benchmark)|Meets criteria
|7.92 Check if Elastic Load Balancers have insecure SSL ciphers (Not part of CIS benchmark)|Meets criteria

|===


==== Security Tools Used

- Prowler

==== Project Limitations

The assessment was conducted against the production AWS environment with the security auditor permissions provided by the company.

== Findings Details


=== Ensure multi-factor authentication (MFA) is enabled for all IAM users that have a console password

CIS SEVERITY:​ ​ ​ [red]#Medium#

PROFILE APPLICABILITY: CIS 1.2

image:./aws-assesment-20210910/prowler_mfa.png[]

USERS AFFECTED:

|===
| ** # ** | ** User **
| 1 | gbillingsley@bayou.net
|===


ISSUE DESCRIPTION:

Multi-Factor Authentication (MFA) adds an extra layer of protection on top of a user name and password. With MFA enabled, when a user signs in to an AWS website, they will be prompted for their user name and password as well as for an authentication code from their AWS MFA device. It is recommended that MFA be enabled for all accounts that have a
console password.

PROOF OF VULNERABILITY:

image:aws-assesment-20210910/aws_mfa_inactive.png[]


RECOMMENDATIONS​:

Perform the following to enable MFA:

1. Sign in to the AWS Management Console and open the link:https://console.aws.amazon.com/iam/[IAM console, window=_blank].
2. In the navigation pane, choose Users.
3. In the User Name list, choose the name of the intended MFA user.
4. Choose the Security Credentials tab, and then choose Manage MFA Device.
5. In the Manage MFA Device wizard, choose A virtual MFA device, and then choose
Next Step.
IAM generates and displays configuration information for the virtual MFA device, including a QR code graphic. The graphic is a representation of the 'secret configuration key' that is available for manual entry on devices that do not support QR codes.
6. Open your virtual MFA application. (For a list of apps that you can use for hosting virtual
MFA devices, see Virtual MFA Applications.) If the virtual MFA application supports
multiple accounts (multiple virtual MFA devices), choose the option to create a new
account (a new virtual MFA device).
7. Determine whether the MFA app supports QR codes, and then do one of the following:
    - Use the app to scan the QR code. For example, you might choose the camera icon or
choose an option similar to Scan code, and then use the device's camera to scan the code.
    - In the Manage MFA Device wizard, choose Show secret key for manual configuration, and then type the secret configuration key into your MFA application. When you are finished, the virtual MFA device starts generating one-time passwords.
8. In the Manage MFA Device wizard, in the Authentication Code 1 box, type the one-time password that currently appears in the virtual MFA device. Wait up to 30 seconds for the device to generate a new one-time password. Then type the second one-time password into the Authentication Code 2 box. Choose Active Virtual MFA.


=== Ensure no security groups allow ingress from 0.0.0.0/0 or ::/0 to port 22

CIS SEVERITY:​ ​ ​ [red]#High#

PROFILE APPLICABILITY: CIS 1.2

image:aws-assesment-20210910/prowler_sg.png[]

|===
| ** Security Group ** | ** Region ** 
| sg-8b441fe8 | us-east-2
|===

ISSUE DESCRIPTION:

Security groups provide stateful filtering of ingress/egress network traffic to AWS resources. It is recommended that no security group allows unrestricted ingress access to port 22.

PROOF OF VULNERABILITY:

image:aws_security_all.png[]

RECOMMENDATIONS​:

Perform the following to implement the prescribed state:

1. Login to the link:https://console.aws.amazon.com/vpc/home[AWS Management VPC, window=_blank] Console.
2. In the left pane, click Security Groups
3. For each security group, perform the following:
4. Select the security group
5. Click the Inbound Rules tab
6. Identify the rules to be removed
7. Click the x in the Remove column
8. Click Save
